# Plum Blossom Wisdom



> çµæ„Ÿæ¥è‡ªåŒç±»å‹ç®—å¦AI
>
> æ¢…èŠ±æ˜“æ•°å…¥é—¨ (ä¸­å›½æ˜“å­¦æ–‡åŒ–ç ”ç©¶é™¢ ç¼–)
>



:::info
ç›®å½•ï¼š

1. é¡¹ç›®èƒŒæ™¯åŠæ¦‚è¿°
2. æ•°æ®å‡†å¤‡
+ æ•°æ®æ”¶é›†ä¸æå–
+ æ•°æ®æ¸…æ´—
+ æ•°æ®é¢„å¤„ç†
3. å¾®è°ƒè®­ç»ƒ
4. promptè°ƒæ•´

:::

## é¡¹ç›®èƒŒæ™¯åŠæ¦‚è¿°ï¼š
### é¡¹ç›®èƒŒæ™¯ï¼š
åœ¨ç§‘å­¦å æ®ä¸»å¯¼åœ°ä½çš„ä»Šå¤©ï¼Œç„å­¦ä»¥å…¶ç¥ç§˜è‰²å½©ä»ç„¶å¸å¼•ç€äººä»¬çš„ç›®å…‰ã€‚![åœ¨billibiliï¼Œè¿™æ ·çš„æ•™å­¦è§†é¢‘æœ‰ä¸Šç™¾ä¸‡çš„æ’­æ”¾](https://cdn.nlark.com/yuque/0/2024/png/45387460/1734157198665-b2bf7f24-16c0-46fa-b793-37b573a1bd9d.png)


å¯¹äºå°†å¦è±¡ç”¨è¿ç®—è¡¨ç¤ºï¼Œ<font style="color:rgb(13, 13, 13);">é€šè¿‡æ•°å­—ã€ç‚¹æ»´å˜åŒ–æ¨æ¼”å‡ºå„ç§å¯èƒ½æ€§çš„æ¢…èŠ±æ˜“æ•°æ¥è¯´ï¼Œç„å­¦æ˜¯å¦å…·æœ‰å…¶ç‹¬åˆ°ä¹‹å¤„å°šæ— å®šè®ºã€‚ã€‚</font>

åœ¨è¿™æ ·çš„æƒ…å½¢ä¸‹ï¼Œ**æœ€ç†æ™ºçš„è¡Œä¸ºæ˜¯å»çœŸæ­£äº†è§£å®ƒï¼Œç„¶åå†æ¥çœ‹åˆ°åº•æ˜¯çŒ«æ˜¯è™**ã€‚åœ¨å­¦ä¹ æˆæœ¬å·²ç»ä¼ æ‰¿ç­‰æ–¹é¢çš„å¦¥åä¸‹ï¼Œä¹Ÿè®¸å°†å…¶åšæˆAIæ¥ä¸€æ¢ç©¶ç«Ÿæ˜¯æœ€å¥½çš„é€‰æ‹©

### é¡¹ç›®æ¦‚è¿°
æœ¬é¡¹ç›®ä½¿ç”¨**ã€Šæ¢…èŠ±æ˜“æ•°å…¥é—¨ (ä¸­å›½æ˜“å­¦æ–‡åŒ–ç ”ç©¶é™¢ ç¼–)ã€‹**ã€**ã€Š****æ¢…èŠ±æ˜“æ•°ç™½è¯è§£****ã€‹**ä½œä¸ºåŸºç¡€æ¡†æ¶ï¼Œä½¿ç”¨è®¯é£å¤§æ¨¡å‹è¿›è¡Œç²¾è°ƒã€‚ä½¿ç”¨è¯¥å¤§æ¨¡å‹æ—¶ï¼Œæ¢…èŠ±æ˜“æ•°AIä¼šè¯¢é—®æ—¶é—´ï¼Œäººç‰©ï¼Œç¯å¢ƒï¼ŒåŠ¨é™ç­‰è¦ç´ ï¼Œæ ¹æ®è¦ç´ è¿›è¡Œè®¡ç®—åç»™å‡ºå‘ç”ŸæŸä»¶äº‹çš„é¢„æµ‹ã€‚

#### åç»­è€ƒè™‘æ·»åŠ :
1. ã€Šå›¾è§£é‚µåº·èŠ‚æ˜“æ•° 1ï¼šé‚µåº·èŠ‚æ¢…èŠ±æ˜“æ•°ã€‹
2. ã€Šæ¢…èŠ±æ˜“æ•°é«˜å±‚ä¹‹è·¯ã€‹
3. ã€Šçš‡æç»ä¸–ã€‹
4. ã€Šå¹²æ”¯æ˜“è±¡å­¦ã€‹
5. ã€ŠæŒ‡ç‚¹æ˜¥é£ â€”â€” ç‹¬è§£æ¢…èŠ±æ˜“æ•°ä¹‹å…«æ³•ã€‹

ç­‰å†…å®¹

---

## æ•°æ®å‡†å¤‡
### æ•°æ®æ”¶é›†ä¸æå–
#### å®‰è£…ä¾èµ–ï¼š
```plain
PyPDF2==3.0.1
pdf2image==1.16.3
pytesseract==0.3.10
transformers==4.30.2
torch==2.0.1
pandas==2.0.3
pyyaml==6.0.1
pillow==9.5.0
opencv-python==4.8.0
numpy==1.24.3
requests==2.31.0
tenacity==8.2.3
```
githubä¸­å®‰è£…tesseractåŠå…¶ä¸­æ–‡åŒ…ä¸poppler
> tesseracté¡¹ç›®https://github.com/tesseract-ocr/tesseract
> tesseractä¸­æ–‡åŒ…https://github.com/tesseract-ocr/tessdata/blob/main/chi_sim.traineddata
> poppleré¡¹ç›®https://github.com/oschwartz10612/poppler-windows
> poppleréœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡å¹¶é‡å¯ç”µè„‘

#### æå–pdf
è¿™éƒ¨åˆ†çš„é¡¹ç›®ç»“æ„
+ project/
+ â”œâ”€â”€ README.md
+ â”œâ”€â”€ requirements.txt
+ â”œâ”€â”€ src/
+ â”‚   â”œâ”€â”€ main.py           # ä¸»ç¨‹åº
+ â”‚   â”œâ”€â”€ pdf_processor.py  # PDFå¤„ç†æ ¸å¿ƒç±»
+ â”‚   â”œâ”€â”€ image_captioner.py # å›¾ç‰‡æè¿°ç”Ÿæˆå™¨
+ â”‚   â”œâ”€â”€ text_cleaner.py   # æ–‡æœ¬æ¸…æ´—å·¥å…·
+ â”‚   â””â”€â”€ data_formatter.py # æ•°æ®æ ¼å¼åŒ–å·¥å…·
+ â”œâ”€â”€ config/
+ â”‚   â””â”€â”€ config.yaml       # é…ç½®æ–‡ä»¶
+ â””â”€â”€ output/               # è¾“å‡ºç›®å½•

**ç”±äºtesseractç²¾åº¦æœ‰é™ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨aiè¿›è¡Œæ ¡æ­£**
```python
import time
import logging
from typing import List, Dict
from volcenginesdkarkruntime import Ark

class TextCorrector:
    def __init__(self, config):
        self.config = config['text_correction']
        self.logger = logging.getLogger(__name__)
        
        # åˆå§‹åŒ– Ark å®¢æˆ·ç«¯
        self.client = Ark(
            ak=self.config['api_key'],
            sk=self.config['api_secret']
        )
        self.model_id = self.config['endpoint']
        
        self.max_retries = self.config.get('max_retries', 3)
        self.batch_size = self.config.get('batch_size', 1000)
    
    def _call_api(self, text: str) -> str:
        try:
            # åˆ›å»ºå¯¹è¯è¯·æ±‚
            response = self.client.chat.completions.create(
                model=self.model_id,
                messages=[
                    {
                        "role": "system",
                        "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æœ¬æ ¡å¯¹ä¸“å®¶ï¼Œè´Ÿè´£ä¿®æ­£OCRæ–‡æœ¬ä¸­çš„é”™è¯¯ã€‚è¯·ç›´æ¥è¿”å›ä¿®æ­£åçš„æ–‡æœ¬ï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–è¯´æ˜ã€‚"
                    },
                    {
                        "role": "user",
                        "content": f"è¯·å¸®æˆ‘æ ¡å¯¹å’Œä¿®æ­£ä»¥ä¸‹OCRè¯†åˆ«çš„æ–‡æœ¬ï¼Œç¡®ä¿æ–‡å­—é€šé¡ºã€æ— é”™åˆ«å­—ï¼š\n\n{text}"
                    }
                ],
                temperature=0.3,
                top_p=0.8,
                max_tokens=2048
            )
            
            return response.choices[0].message.content.strip()
            
        except Exception as e:
            self.logger.error(f"APIè°ƒç”¨å¤±è´¥: {str(e)}")
            raise
    
    def correct_text(self, text: str) -> str:
        """å¤„ç†æ–‡æœ¬å¹¶è¿›è¡Œæ ¡æ­£"""
        if not text.strip():
            return text
            
        # åˆ†æ®µå¤„ç†é•¿æ–‡æœ¬
        segments = self._split_text(text)
        corrected_segments = []
        
        for segment in segments:
            try:
                corrected_text = self._call_api(segment)
                corrected_segments.append(corrected_text)
                # æ·»åŠ å»¶æ—¶é¿å…APIé™åˆ¶
                time.sleep(0.5)
            except Exception as e:
                self.logger.error(f"å¤„ç†æ–‡æœ¬æ®µè½æ—¶å‡ºé”™: {str(e)}")
                corrected_segments.append(segment)  # å¦‚æœå¤±è´¥åˆ™ä¿ç•™åŸæ–‡
        
        return "\n".join(corrected_segments)
    
    def _split_text(self, text: str) -> List[str]:
        """å°†é•¿æ–‡æœ¬åˆ†å‰²æˆé€‚åˆAPIå¤„ç†çš„ç‰‡æ®µ"""
        segments = []
        current_segment = []
        current_length = 0
        
        for paragraph in text.split('\n'):
            if current_length + len(paragraph) > self.batch_size:
                if current_segment:
                    segments.append('\n'.join(current_segment))
                current_segment = [paragraph]
                current_length = len(paragraph)
            else:
                current_segment.append(paragraph)
                current_length += len(paragraph)
        
        if current_segment:
            segments.append('\n'.join(current_segment))
        
        return segments
```

![åœ¨è·‘ä¸­çš„aiæ ¡æ­£](https://cdn.nlark.com/yuque/0/2024/png/45387460/1734173725632-adb5adcd-d8d5-4fcb-9c66-cda52a3efce4.png)



---

## ğŸš«ä»¥ä¸‹æ­£åœ¨æ–½å·¥ğŸš§
### æ•°æ®æ¸…æ´—
å…ˆä½¿ç”¨æ­£åˆ™è¿ç®—è¿›è¡ŒåŸºæœ¬çš„æ¸…æ´—

### æ•°æ®é¢„å¤„ç†
å¦‚tianjié¡¹ç›®ä¸­çš„æ•°æ®å¤„ç†æ¨¡å—ï¼Œä½¿ç”¨aiè½¬åŒ–ä¸ºé—®ç­”å½¢å¼

(ç»å®è·µï¼Œtianjiç”Ÿæˆçš„æ ¼å¼ä¸å¯¹ç§°äºè®¯é£çš„æ ¼å¼è¦æ±‚ï¼Œå·²åœ¨å…¶åŸºç¡€ä¸Šä¿®æ”¹ä¸ºAlpacaæ ¼å¼)

### å¾®è°ƒè®­ç»ƒ
ä½¿ç”¨è®¯é£å¤§æ¨¡å‹ç½‘ç«™è¿›è¡Œå¾®è°ƒï¼Œè§†æ•ˆæœè°ƒæ•´



### promptè°ƒæ•´
é¢„è®¡æˆ‘ä»¬ä¼šå°†æˆ‘ä»¬çš„æ¢…èŠ±æ˜“æ•°AIè®¾ç½®ç»Ÿä¸€çš„è¾“å…¥è¾“å‡ºåŠè¿½é—®æ¨¡ç‰ˆï¼Œä»¥ä¾¿å…¶è§„èŒƒæ€§ã€‚åŒæ—¶ä¼šè®©å…¶è¾“å‡ºä»–çš„æ•°å­¦è¿ç®—è¿‡ç¨‹ï¼ŒåŠç®—å¦ä¾æ®ã€‚
